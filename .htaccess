# =========================
# GluOne .htaccess (REG.RU)
# =========================

# Пробрасываем Authorization (если нужно PHP)
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

# Не угадывать расширения
Options -MultiViews
DirectoryIndex index.html

RewriteEngine On
RewriteBase /

# --- ЧИСТЫЕ URL ---

# 1) Отдаём существующие файлы/папки как есть
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2) INTERNAL: /page -> /page.html (если такой файл есть)
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+?)/?$ $1.html [L]

# 3) SEO-редирект: /page.html -> /page (только если .html был в ИСХОДНОМ запросе)
RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[?\s] [NC]
RewriteRule ^ %1 [R=301,L]


# --- ПОЛИТИКИ: заголовки для конкретных страниц ---
# На некоторых shared-конфигурациях Nginx может не пропускать обычный ETag,
# поэтому дублируем хэш в X-Policy-ETag (на него и опираемся в бэке).

<IfModule mod_headers.c>

  # privacy
  <Files "privacy.html">
    Header set X-Policy-Slug "privacy"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "6149042b587c2f5ed34a80e2c2ea200adb9e75ddddd945315812a03dee97a698"
    FileETag None
    Header set ETag "\"6149042b587c2f5ed34a80e2c2ea200adb9e75ddddd945315812a03dee97a698\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # consent
  <Files "consent.html">
    Header set X-Policy-Slug "consent"
    Header set X-Policy-Version "2025-09-16-v3"
    Header set X-Policy-ETag "535cac1c51ce74eb9b528daee1e51dc58a101ff87f34a1331315b2952ccf58b0"
    FileETag None
    Header set ETag "\"535cac1c51ce74eb9b528daee1e51dc58a101ff87f34a1331315b2952ccf58b0\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # terms
  <Files "terms.html">
    Header set X-Policy-Slug "terms"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "78e5df4a389f05b42b879f020fd106e2ef8976dad0dd0c900ff20ee2cf287dca"
    FileETag None
    Header set ETag "\"78e5df4a389f05b42b879f020fd106e2ef8976dad0dd0c900ff20ee2cf287dca\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # offer
  <Files "offer.html">
    Header set X-Policy-Slug "offer"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "bd815d928c81d52035e90b56126304be11f763cb5aed12bf6d52d5b75ce8e7f9"
    FileETag None
    Header set ETag "\"bd815d928c81d52035e90b56126304be11f763cb5aed12bf6d52d5b75ce8e7f9\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

</IfModule>
