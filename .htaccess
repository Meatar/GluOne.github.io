# =========================
# GluOne .htaccess (REG.RU)
# =========================

SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
Options -MultiViews
DirectoryIndex index.html

RewriteEngine On
RewriteBase /

# --- SEO-редиректы СНАЧАЛА ---
# /index.html -> /
RewriteCond %{THE_REQUEST} \s/+index\.html[?\s] [NC]
RewriteRule ^index\.html$ / [R=301,L]

# /page.html -> /page (только если файл реально существует)
RewriteCond %{REQUEST_URI} !^/assets/        [NC]
RewriteCond %{REQUEST_URI} !^/\.well-known/  [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(.+)\.html$ /$1 [R=301,L]

# --- ЧИСТЫЕ URL ---
# если запрошен реальный файл/папка — отдаём как есть
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# /page -> /page.html (внутреннее сопоставление)
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+?)/?$ $1.html [L]

# --- Заголовки для policy-страниц ---
<IfModule mod_headers.c>
  # privacy
  <Files "privacy.html">
    Header set X-Policy-Slug "privacy"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "6149042b587c2f5ed34a80e2c2ea200adb9e75ddddd945315812a03dee97a698"
    FileETag None
    Header set ETag "\"6149042b587c2f5ed34a80e2c2ea200adb9e75ddddd945315812a03dee97a698\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # consent
  <Files "consent.html">
    Header set X-Policy-Slug "consent"
    Header set X-Policy-Version "2025-09-16-v3"
    Header set X-Policy-ETag "535cac1c51ce74eb9b528daee1e51dc58a101ff87f34a1331315b2952ccf58b0"
    FileETag None
    Header set ETag "\"535cac1c51ce74eb9b528daee1e51dc58a101ff87f34a1331315b2952ccf58b0\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # terms
  <Files "terms.html">
    Header set X-Policy-Slug "terms"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "78e5df4a389f05b42b879f020fd106e2ef8976dad0dd0c900ff20ee2cf287dca"
    FileETag None
    Header set ETag "\"78e5df4a389f05b42b879f020fd106e2ef8976dad0dd0c900ff20ee2cf287dca\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>

  # offer
  <Files "offer.html">
    Header set X-Policy-Slug "offer"
    Header set X-Policy-Version "2025-09-16-v1"
    Header set X-Policy-ETag "bd815d928c81d52035e90b56126304be11f763cb5aed12bf6d52d5b75ce8e7f9"
    FileETag None
    Header set ETag "\"bd815d928c81d52035e90b56126304be11f763cb5aed12bf6d52d5b75ce8e7f9\""
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header merge Vary "Accept-Encoding"
  </Files>
</IfModule>
